import React, { useContext, useEffect, useState } from "react";
import { Button, Row } from "react-bootstrap";
import { Link } from "react-router-dom";
import JourneySectionList from "../Sections/JourneySectionList";
import JourneySectionDetail from "../Sections/JourneySectionDetail";
import { ContentContext } from "../../../../context/ContentContext";

const PatientJourneyLanding = () => {
  const { filterAges, fetchAgeGroups } = useContext(ContentContext);
  const path_image = import.meta.env.VITE_IMAGES_PATH;
  const [activeSection, setActiveSection] = useState(null);
  // const [isHcpSelected, setIsHcpSelected] = useState(false);

  useEffect(() => {
    (async () => await fetchAgeGroups())();
  }, []);
  // const toggleUserType = () => setIsHcpSelected((prev) => !prev);
  const handleSectionClick = (section) => setActiveSection(section);

    const [isMobileSrceen, setIsMobileSrceen] = React.useState(window.innerWidth <= 480);
  
    React.useEffect(() => {
      const handleResize = () => {
        setIsMobileSrceen(window.innerWidth <= 480);
      };
  
      window.addEventListener("resize", handleResize);
      return () => window.removeEventListener("resize", handleResize);
    }, []);

  return (
    <div className="main-page">
      <div className="container-fluid">
        <Row>
          <section className="journey-box">
            {!activeSection ? (
              <>
                <div className="explore-journey">
                  <div className="filter-age">
                    <h3>Explore your <span>patient's Journey</span></h3>
                    <div className="explore-journey-block">
                      <div className="explore-journey-block-inner">
                        {isMobileSrceen ? (
                        <svg xmlns="http://www.w3.org/2000/svg" width="351" height="538" viewBox="0 0 351 538" fill="none">
                        <g filter="url(#filter0_d_3825_33796)">
                       <path d="M118.939 10.8C123.89 10.8 127.57 15.35 127.57 20.3C127.57 33.163 132.627 45.4995 141.629 54.595C150.596 63.6551 162.745 68.7595 175.422 68.7991C175.443 68.7991 175.463 68.8077 175.477 68.8217C175.492 68.836 175.496 68.857 175.5 68.8771C175.504 68.8973 175.508 68.9185 175.523 68.9329C175.537 68.9467 175.557 68.9552 175.578 68.9553C185.454 68.976 194.922 72.9077 201.907 79.8928C208.911 86.8964 212.845 96.3955 212.845 106.3C212.845 116.205 208.911 125.704 201.907 132.707C194.922 139.692 185.454 143.624 175.578 143.645C175.557 143.645 175.537 143.653 175.523 143.667C175.508 143.682 175.504 143.703 175.5 143.723C175.496 143.743 175.492 143.764 175.477 143.778C175.463 143.792 175.443 143.801 175.422 143.801C162.745 143.841 150.596 148.945 141.629 158.005C132.627 167.101 127.57 179.437 127.57 192.3C127.57 205.163 132.627 217.499 141.629 226.595C150.596 235.655 162.745 240.76 175.422 240.799C175.443 240.799 175.463 240.808 175.477 240.822C175.492 240.836 175.496 240.857 175.5 240.877C175.504 240.897 175.508 240.918 175.523 240.933C175.537 240.947 175.557 240.955 175.578 240.955C185.454 240.976 194.922 244.908 201.907 251.893C208.911 258.896 212.845 268.396 212.845 278.3C212.845 288.205 208.911 297.704 201.907 304.707C194.922 311.692 185.454 315.624 175.578 315.645C175.557 315.645 175.537 315.653 175.523 315.667C175.508 315.682 175.504 315.703 175.5 315.723C175.496 315.743 175.492 315.764 175.477 315.778C175.463 315.792 175.443 315.801 175.422 315.801C162.745 315.841 150.596 320.945 141.629 330.005C132.627 339.101 127.57 351.437 127.57 364.3C127.57 377.163 132.627 389.499 141.629 398.595C150.596 407.655 162.745 412.76 175.422 412.799C175.443 412.799 175.463 412.808 175.477 412.822C175.492 412.836 175.496 412.857 175.5 412.877C175.504 412.897 175.508 412.918 175.523 412.933C175.537 412.947 175.557 412.955 175.578 412.955C185.454 412.976 194.922 416.908 201.907 423.893C208.911 430.896 212.845 440.396 212.845 450.3C212.845 460.205 208.911 469.704 201.907 476.707C194.922 483.692 185.454 487.624 175.578 487.645C175.535 487.645 175.5 487.679 175.5 487.722C175.5 487.765 175.465 487.8 175.422 487.8C162.587 487.821 150.282 492.928 141.205 502.005C139.103 504.107 137.214 506.383 135.551 508.797C129.063 518.223 119.702 526.8 108.259 526.8H25C11.7452 526.8 1 516.055 1 502.8V34.8C1.00001 21.5452 11.7452 10.8 25 10.8H118.939ZM326 10.8C339.255 10.8 350 21.5452 350 34.8V502.8C350 516.055 339.255 526.8 326 526.8H159.11C149.141 526.8 142.043 516.942 149.093 509.893C156.078 502.908 165.546 498.976 175.422 498.955C175.465 498.955 175.5 498.92 175.5 498.877C175.5 498.835 175.535 498.8 175.578 498.8C188.413 498.779 200.718 493.672 209.795 484.595C218.89 475.499 224 463.163 224 450.3C224 437.437 218.89 425.101 209.795 416.005C200.734 406.945 188.458 401.84 175.648 401.801C175.627 401.801 175.607 401.792 175.593 401.778C175.579 401.764 175.574 401.743 175.57 401.723C175.566 401.703 175.562 401.682 175.547 401.667C175.533 401.653 175.514 401.645 175.492 401.645C165.718 401.624 156.348 397.692 149.436 390.707C142.504 383.704 138.61 374.205 138.61 364.3C138.61 354.396 142.504 344.896 149.436 337.893C156.348 330.908 165.718 326.976 175.492 326.955C175.514 326.955 175.533 326.947 175.547 326.933C175.562 326.918 175.566 326.897 175.57 326.877C175.574 326.857 175.579 326.836 175.593 326.822C175.607 326.808 175.627 326.799 175.648 326.799C188.458 326.76 200.734 321.655 209.795 312.595C218.89 303.499 224 291.163 224 278.3C224 265.437 218.89 253.101 209.795 244.005C200.734 234.945 188.458 229.84 175.648 229.801C175.627 229.801 175.607 229.792 175.593 229.778C175.579 229.764 175.574 229.743 175.57 229.723C175.566 229.703 175.562 229.682 175.547 229.667C175.533 229.653 175.514 229.645 175.492 229.645C165.718 229.624 156.348 225.692 149.436 218.707C142.504 211.704 138.61 202.205 138.61 192.3C138.61 182.396 142.504 172.896 149.436 165.893C156.348 158.908 165.718 154.976 175.492 154.955C175.514 154.955 175.533 154.947 175.547 154.933C175.562 154.918 175.566 154.897 175.57 154.877C175.574 154.857 175.579 154.836 175.593 154.822C175.607 154.808 175.627 154.799 175.648 154.799C188.458 154.76 200.734 149.655 209.795 140.595C218.89 131.499 224 119.163 224 106.3C224 93.437 218.89 81.1006 209.795 72.0051C200.734 62.9446 188.458 57.8402 175.648 57.801C175.627 57.8009 175.607 57.7924 175.593 57.7784C175.579 57.7641 175.574 57.7431 175.57 57.723C175.566 57.7028 175.562 57.6816 175.547 57.6672C175.533 57.6534 175.514 57.6449 175.492 57.6448C165.718 57.6239 156.348 53.6921 149.436 46.7073C142.504 39.7037 138.61 30.2046 138.61 20.3C138.61 14.6439 143.777 10.8 149.433 10.8H326Z" fill="#1D3F50"/>
                      </g>
                         <defs>
                         <filter id="filter0_d_3825_33796" x="-9.8" y="4.86374e-05" width="370.6" height="537.6" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                         <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                         <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                        <feOffset/>
                        <feGaussianBlur stdDeviation="5.4"/>
                        <feComposite in2="hardAlpha" operator="out"/>
                       <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.32 0"/>
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_3825_33796"/>
                         <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_3825_33796" result="shape"/>
                        </filter>
                        </defs>
                        </svg>
                        ):(
                      <svg width="1392" height="658" viewBox="0 0 1392 658" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g filter="url(#filter0_d_3825_33335)">
                        <path d="M1296 238.1C1319.55 238.1 1342.14 247.414 1358.79 263.992C1375.42 280.547 1384.77 302.991 1384.8 326.4C1384.8 326.455 1384.84 326.5 1384.9 326.5C1384.96 326.5 1385 326.545 1385 326.6C1385.01 338.403 1386.92 350.01 1390.55 361.018C1391.46 363.748 1392 366.592 1392 369.468V634C1392 647.255 1381.25 658 1368 658H24C10.7452 658 0 647.255 0 634V369.468C0 366.592 0.543161 363.748 1.44523 361.018C5.08145 350.01 6.98922 338.403 6.99995 326.6C7 326.545 7.04482 326.5 7.1001 326.5C7.15538 326.5 7.20019 326.455 7.20025 326.4C7.22688 302.991 16.5796 280.547 33.209 263.992C49.8622 247.414 72.4488 238.1 96 238.1C119.551 238.1 142.138 247.414 158.791 263.992C175.42 280.547 184.773 302.991 184.8 326.4C184.8 326.455 184.845 326.5 184.9 326.5C184.955 326.5 185 326.545 185 326.6C185.027 355.87 196.718 383.937 217.511 404.636C238.327 425.359 266.561 437 296 437C325.439 437 353.673 425.358 374.489 404.636C395.282 383.937 406.973 355.87 407 326.6C407 326.545 407.045 326.5 407.1 326.5C407.155 326.5 407.2 326.455 407.2 326.4C407.227 302.991 416.58 280.547 433.209 263.992C449.862 247.414 472.449 238.1 496 238.1C519.551 238.1 542.138 247.414 558.791 263.992C575.42 280.547 584.773 302.991 584.8 326.4C584.8 326.455 584.845 326.5 584.9 326.5C584.955 326.5 585 326.545 585 326.6C585.027 355.87 596.718 383.937 617.511 404.636C638.327 425.359 666.561 437 696 437C725.439 437 753.673 425.358 774.489 404.636C795.282 383.937 806.973 355.87 807 326.6C807 326.545 807.045 326.5 807.1 326.5C807.155 326.5 807.2 326.455 807.2 326.4C807.227 302.991 816.58 280.547 833.209 263.992C849.862 247.414 872.449 238.1 896 238.1C919.551 238.1 942.138 247.414 958.791 263.992C975.42 280.547 984.773 302.991 984.8 326.4C984.8 326.455 984.845 326.5 984.9 326.5C984.955 326.5 985 326.545 985 326.6C985.027 355.87 996.718 383.937 1017.51 404.636C1038.33 425.359 1066.56 437 1096 437C1125.44 437 1153.67 425.358 1174.49 404.636C1195.28 383.937 1206.97 355.87 1207 326.6C1207 326.545 1207.04 326.5 1207.1 326.5C1207.16 326.5 1207.2 326.455 1207.2 326.4C1207.23 302.991 1216.58 280.547 1233.21 263.992C1249.86 247.414 1272.45 238.1 1296 238.1ZM1368 0C1381.25 0 1392 10.7452 1392 24V242.307C1392 250.23 1380.1 253.954 1374.49 248.364C1353.67 227.642 1325.44 216 1296 216C1266.56 216 1238.33 227.641 1217.51 248.364C1196.72 269.063 1185.03 297.13 1185 326.4C1185 326.455 1184.96 326.5 1184.9 326.5C1184.84 326.5 1184.8 326.545 1184.8 326.6C1184.77 350.009 1175.42 372.453 1158.79 389.008C1142.14 405.586 1119.55 414.9 1096 414.9C1072.45 414.9 1049.86 405.586 1033.21 389.008C1016.58 372.453 1007.23 350.009 1007.2 326.6C1007.2 326.545 1007.16 326.5 1007.1 326.5C1007.04 326.5 1007 326.455 1007 326.4C1006.97 297.13 995.282 269.063 974.489 248.364C953.673 227.642 925.439 216 896 216C866.561 216 838.327 227.641 817.511 248.364C796.718 269.063 785.027 297.13 785 326.4C785 326.455 784.955 326.5 784.9 326.5C784.845 326.5 784.8 326.545 784.8 326.6C784.773 350.009 775.42 372.453 758.791 389.008C742.138 405.586 719.551 414.9 696 414.9C672.449 414.9 649.862 405.586 633.209 389.008C616.58 372.453 607.227 350.009 607.2 326.6C607.2 326.545 607.155 326.5 607.1 326.5C607.045 326.5 607 326.455 607 326.4C606.973 297.13 595.282 269.063 574.489 248.364C553.673 227.642 525.439 216 496 216C466.561 216 438.327 227.641 417.511 248.364C396.718 269.063 385.027 297.13 385 326.4C385 326.455 384.955 326.5 384.9 326.5C384.845 326.5 384.8 326.545 384.8 326.6C384.773 350.009 375.42 372.453 358.791 389.008C342.138 405.586 319.551 414.9 296 414.9C272.449 414.9 249.862 405.586 233.209 389.008C216.58 372.453 207.227 350.009 207.2 326.6C207.2 326.545 207.155 326.5 207.1 326.5C207.045 326.5 207 326.455 207 326.4C206.973 297.13 195.282 269.063 174.489 248.364C153.673 227.642 125.439 216 96 216C66.561 216 38.3273 227.641 17.5107 248.364C11.8958 253.954 0 250.23 0 242.307V24C1.03081e-06 10.7452 10.7452 0 24 0H1368Z" fill="#1D3F50" />
                      </g>
                      <defs>
                        <filter id="filter0_d_3825_33335" x="-10.8" y="-10.8" width="1413.6" height="679.6" filterUnits="userSpaceOnUse" colorInterpolationFilters="sRGB">
                          <feFlood floodOpacity="0" result="BackgroundImageFix" />
                          <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                          <feOffset />
                          <feGaussianBlur stdDeviation="5.4" />
                          <feComposite in2="hardAlpha" operator="out" />
                          <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.32 0" />
                          <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_3825_33335" />
                          <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_3825_33335" result="shape" />
                        </filter>
                      </defs>
                      </svg>
                        )}
                    <div className="age-filter-block">
                    {filterAges.loading ? (
                      <></>
                    ) : filterAges.error ? (
                      <></>
                    ) : (
                      filterAges.data &&
                      filterAges.data.length > 0 &&
                      filterAges.data.map((age, idx) => {
                        const ageName = age.label.split("<br />")[0]
                        const ageGroup = age.label.split("Age ")[1].replace("&lt;","<").replace("&gt;",">")
                        const ageClassName = "age"+(age.label.split("Age ")[1].replace("&lt;","0-").replace("&gt;","")).split("-")[0]
                        return (<div key={age.id} className={"block "+ageClassName}>
                          <p>{ageName}</p>
                          <div className="line"></div>
                          <div className="age-group-circle">
                            <img src={path_image + "ages/"+age.allImage} alt=""/>
                          </div>
                          <div className="age-gap">
                            {ageGroup}
                          </div>
                        </div>)}
                      )
                    )}
                    </div>
                    </div>
                    <div className="explore-btn">
                      <Link to="/touchpoints" className="btn-primary">
                        Start exploring
                        {isMobileSrceen ? <img src={path_image + "arrow-right.svg"} alt="" /> :
                        <img src={path_image + "left-arrow-white.svg"} alt="" />
                       }
                      </Link>
                    </div>
                    </div>
                  </div>
                </div>
                <div className="journey-box-right">
                <JourneySectionList
                  onSectionClick={handleSectionClick}
                  section={activeSection}
                />

                </div>
              </>
            ) : (
              <JourneySectionDetail
                onSectionClick={handleSectionClick}
                section={activeSection}
              />
            )}
          </section>
        </Row>
      </div>
    </div>
  );
};

export default PatientJourneyLanding;
